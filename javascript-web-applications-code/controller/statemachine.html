<!DOCTYPE html>
<html>

<head>
	<meta charset=utf-8>
	<script src="../lib/jquery-1.11.0.js" type="text/javascript" charset="utf-8"></script>

	<script type="text/javascript" charset="utf-8">
		var Events = {
		      bind: function(){
		        if ( !this.o ) this.o = $({});
		        this.o.bind.apply(this.o, arguments);
		      },
		      
		      trigger: function(){
		        if ( !this.o ) this.o = $({});
		        this.o.trigger.apply(this.o, arguments);
		      }
		    };
		    
		    var StateMachine = function(){};
		    StateMachine.fn  = StateMachine.prototype;
		    $.extend(StateMachine.fn, Events);
		    
		    StateMachine.fn.add = function(controller){
		      this.bind("change", function(e, current){
		        if (controller == current)
		          controller.activate();
		        else
		          controller.deactivate();
		      });
		      
		      controller.active = $.proxy(function(){
		        this.trigger("change", controller);
		      }, this);
		    };
		    
		    var con1 = {
		      activate: function(){ 
		        console.log("controller 1 activated");
		      },
		      deactivate: function(){ 
		        console.log("controller 1 deactivated");
		      }
		    };
		    
		    var con2 = {
		      activate: function(){ 
		        console.log("controller 2 activated");
		      },
		      deactivate: function(){ 
		        console.log("controller 2 deactivated");
		      }
		    };
		    
		    var sm = new StateMachine;
		    sm.add(con1);
		    sm.add(con2);
		    
		    con1.active();
	</script>
</head>

<body>
	<p>
		“有限状态机”（Finite State Machines, FSM）——是编写UI程序的利器。使用状态机可以轻松地管理很多控制器，根据需要显示和隐藏视图。
	</p>
	<p>
		本质上讲状态机由两部分组成：状态和转换器。它只有一个活动状态，但也可以包含很多非活动状态（passive state）。当活动状态之间相互切换时就会调用状态转换器。
	</p>
	<p>
		两个视图是互斥关系，其中一个显示时另一个一定是隐藏。这个场景就非常适合引入状态机，因为它能确保每个时刻只有一种视图是激活的。
	</p>
</body>

</html>